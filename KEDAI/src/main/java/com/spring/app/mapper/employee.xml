<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="employee">
	
	<resultMap id="MemberJoinDeptJob"     type="HashMap">
        <result property="empid" 		  column="empid" 			javaType="String"/>
        <result property="name" 		  column="name" 			javaType="String"/>
        <result property="nickname" 	  column="nickname" 		javaType="String"/>
        <result property="email" 		  column="email" 			javaType="String"/>
        <result property="mobile" 	 	  column="mobile" 			javaType="String"/>
        <result property="postcode" 	  column="postcode" 		javaType="String"/>
        <result property="address" 		  column="address" 		 	javaType="String"/>
        <result property="detailaddress"  column="detailaddress" 	javaType="String"/>
        <result property="extraaddress"   column="extraaddress" 	javaType="String"/>
        <result property="imgfilename" 	  column="imgfilename" 		javaType="String"/>
        <result property="orgimgfilename" column="orgimgfilename" 	javaType="String"/>
        <result property="hire_date" 	  column="hire_date" 		javaType="String"/>
        <result property="salary" 		  column="salary" 			javaType="String"/>
        <result property="point" 		  column="point" 			javaType="String"/>
        <result property="fk_dept_code"   column="fk_dept_code" 	javaType="String"/>
        <result property="fk_job_code" 	  column="fk_job_code" 		javaType="String"/>
        <result property="dept_tel" 	  column="dept_tel" 		javaType="String"/>
		<result property="dept_code" 	  column="dept_code" 		javaType="String"/>
        <result property="dept_name" 	  column="dept_name"		javaType="String"/>
        <result property="job_code"		  column="job_code"			javaType="String"/>
        <result property="job_name" 	  column="job_name"			javaType="String"/>
    </resultMap>
	
	<!-- 직원 리스트 가져오기 -->
	<select id="employeeList" parameterType="HashMap" resultMap="MemberJoinDeptJob">
		SELECT empid, name, nickname, mobile, email
		     , postcode, address, detailaddress, extraaddress
		     , imgfilename, orgimgfilename, hire_date, salary, point
		     , fk_dept_code, dept_code, dept_name, fk_job_code, job_code, job_name, dept_tel
		FROM 
		(
		    select empid, name, nickname
		         , email, mobile, postcode, address, detailaddress, extraaddress
		         , imgfilename, orgimgfilename, to_char(hire_date, 'yyyy-mm-dd') AS hire_date, salary, point
		         , fk_dept_code, dept_code, nvl(D.dept_name, ' ') AS dept_name
		         , fk_job_code, job_code, nvl(J.job_name, ' ') AS job_name
		         , dept_tel
		         , rownum row_num
		    from tbl_employees E1 
		    LEFT JOIN tbl_dept D ON E1.fk_dept_code = D.dept_code
		    LEFT JOIN tbl_job J ON E1.fk_job_code = J.job_code
		    WHERE rownum &lt;= ((#{page} * #{size}))
			and status = 1 
			and dept_code is not null
	    <choose>
			<when test="searchType == 'department'">
			AND dept_name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'position'">
			AND job_name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'name'">
			AND name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'personal-tel'">
			and mobile = #{searchWord}
			</when>
		</choose>
		    order by dept_name asc, job_code asc
		) E
		WHERE row_num &gt;= (((#{page}-1) * #{size}) + 1)
	</select>

 
 	<select id="employeeListTotal" parameterType="HashMap" resultType="long">
		    select count(*)
		    from tbl_employees E1
		    LEFT JOIN tbl_dept D ON E1.fk_dept_code = D.dept_code
			LEFT JOIN tbl_job J ON E1.fk_job_code = J.job_code
			WHERE status = 1 
			and dept_code is not null
	    <choose>
			<when test="searchType == 'department'">
			AND dept_name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'position'">
			AND job_name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'name'">
			AND name like '%'||#{searchWord}||'%'
			</when>
			<when test="searchType == 'personal-tel'">
			AND mobile = #{searchWord}
			</when>
		</choose>
	</select> 
	

	<!-- 클릭한 사원정보 가져오기 -->
	<select id="empDetailList" resultMap="MemberJoinDeptJob">
		SELECT empid, name, nickname, mobile, email
		     , postcode, address, detailaddress, extraaddress
		     , imgfilename, orgimgfilename, hire_date, salary, point
		     , fk_dept_code, dept_code, dept_name, fk_job_code, job_code, job_name, dept_tel
		FROM 
		(
		    select empid, name, nickname
		         , email, mobile, postcode, address, detailaddress, extraaddress
		         , imgfilename, orgimgfilename, to_char(hire_date, 'yyyy-mm-dd') AS hire_date, salary, point
		         , fk_dept_code, dept_code, nvl(D.dept_name, ' ') AS dept_name
		         , fk_job_code, job_code, nvl(J.job_name, ' ') AS job_name
		         , dept_tel
		    from tbl_employees E1 
		    LEFT JOIN tbl_dept D ON E1.fk_dept_code = D.dept_code
		    LEFT JOIN tbl_job J ON E1.fk_job_code = J.job_code
		    order by dept_name asc, job_code asc
		) E
        where empid = #{empid}
	</select>
		
	
</mapper>